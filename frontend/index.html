<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Compro Assignment</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script
      src="https://kit.fontawesome.com/aebf5cc6b2.js"
      crossorigin="anonymous"
    ></script>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700;900&display=swap"
      rel="stylesheet"
    />
    <link rel="stylesheet" href="scss/style.css" />
  </head>
  <body>
    <div class="side-menu">
      <div class="logo">
        <i class="fa-brands fa-css3"></i>
      </div>

      <div class="icon-list">
        <span>
          <i class="fa-solid fa-house-chimney"></i>
        </span>
        <span>
          <i class="fa-solid fa-cube"></i>
        </span>
        <span>
          <i class="fa-solid fa-landmark"></i>
        </span>
        <span>
          <i class="fa-solid fa-upload"></i>
        </span>
        <span>
          <i class="fa-solid fa-users"></i>
        </span>
      </div>
    </div>
    <div class="container">
      <div class="topbar">
        <div>
          <span>
            <i class="fa-solid fa-bars"></i>
          </span>
          <p>|</p>
          <p class="topbar-heading">Cambridge university press</p>
        </div>
        <div>
          <p><strong>Nikhil Aggarwal&nbsp;</strong>(superadmin)</p>
          <span> <i class="fa-solid fa-caret-down"></i> </span>
        </div>
      </div>
      <div class="main-content">
        <div class="dashboard-heading">
          <div>Dashboard</div>
          <div>Dashboard -<strong>Summary</strong></div>
        </div>
        <div class="dashboard-content">
          <div class="activities">
            <div class="activities-heading">Recent activities</div>
          </div>
          <div class="related-content">
            <div class="item-detail aside">
              <div class="item-detail-heading aside-heading">
                <p>cqa_familiy_10dec2021_9 - updated</p>
                <span>
                  <i class="fa-solid fa-circle-xmark"></i>
                </span>
              </div>
              <div class="aside-content">
                <div><strong>Type</strong>:Product</div>
                <div><strong>Author</strong>:Product</div>
                <div><strong>Last Mofidified Date</strong>:Product</div>
                <div><strong>Status</strong>:Product</div>
              </div>
            </div>
            <div class="products aside">
              <div class="aside-heading">
                <p>Products</p>
                <p>2798</p>
              </div>
              <div class="aside-content">
                <div class="product-list">
                  <div class="product-list-item">
                    <div>
                      <span>250</span>
                    </div>
                    <p>Downloadable asset</p>
                  </div>
                  <div class="product-list-item">
                    <div>
                      <span>41</span>
                    </div>
                    <p>External resources</p>
                  </div>
                  <div class="product-list-item">
                    <div>
                      <span>1434</span>
                    </div>
                    <p>practice extra</p>
                  </div>
                  <div class="product-list-item">
                    <div>
                      <span>322</span>
                    </div>
                    <p>presentation plus</p>
                  </div>
                  <div class="product-list-item">
                    <div>
                      <span>383</span>
                    </div>
                    <p>resource bank</p>
                  </div>
                  <div class="product-list-item">
                    <div>
                      <span>156</span>
                    </div>
                    <p>test</p>
                  </div>
                  <div class="product-list-item">
                    <div>
                      <span>212</span>
                    </div>
                    <p>test generator</p>
                  </div>
                </div>
              </div>
            </div>
            <div class="shortcuts aside">
              <div class="aside-heading">
                <p>shortcuts</p>
              </div>
              <div class="aside-content">
                <p class="shortcuts-heading">Create a new product</p>
                <div class="shortcuts-list">
                  <div class="shortcuts-list-item">
                    <span>
                      <i class="fa-solid fa-share"></i>
                    </span>
                    <p>Practice extra</p>
                  </div>
                  <div class="shortcuts-list-item">
                    <span>
                      <i class="fa-solid fa-share"></i>
                    </span>
                    <p>resourec bank</p>
                  </div>
                  <div class="shortcuts-list-item">
                    <span>
                      <i class="fa-solid fa-share"></i>
                    </span>
                    <p>presentation plus</p>
                  </div>
                  <div class="shortcuts-list-item">
                    <span>
                      <i class="fa-solid fa-share"></i>
                    </span>
                    <p>test generator</p>
                  </div>
                  <div class="shortcuts-list-item">
                    <span>
                      <i class="fa-solid fa-share"></i>
                    </span>
                    <p>downloadable asset</p>
                  </div>
                  <div class="shortcuts-list-item">
                    <span>
                      <i class="fa-solid fa-share"></i>
                    </span>
                    <p>test</p>
                  </div>
                  <div class="shortcuts-list-item">
                    <span>
                      <i class="fa-solid fa-share"></i>
                    </span>
                    <p>external resources</p>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script>
      $(document).ready(function () {
        let state = {
          selectedIndex: null,
          selectedData: null,
          data: null,
        };

        function getTimeDiff(input) {
          let inputDate = new Date(input);
          let now = new Date();
          let diff = now - inputDate;

          return `${Math.floor(diff / 1000 / 60 / 60)} hours ago`;
        }

        function openDetail(index) {
          if (state.selectedIndex || state.selectedIndex === 0) {
            $(`.${state.selectedIndex}`).removeClass("accent-background");
          }
          $(`.${index}`).addClass("accent-background");
          state.selectedIndex = index;
          state.selectedData = state.data[index];
          $(
            ".item-detail"
          ).html(`<div class="item-detail-heading aside-heading">
                  <p>${state.selectedData.doc["product-title"]}</p>
                  <span>
                    <i class="fa-solid fa-circle-xmark"></i>
                  </span>
                </div>
                <div class="aside-content">
                  <div><strong>Type</strong>:${
                    state.selectedData.doc.type
                  }</div>
                  <div><strong>Author</strong>:${
                    state.selectedData.doc["last-modified"].by
                  }</div>
                  <div><strong>Last Mofidified Date</strong>:${new Date(
                    state.selectedData.doc["last-modified"].time
                  )}</div>
                  <div><strong>Status</strong>:${
                    state.selectedData.doc.status
                  }</div>
                </div>`);

          $(".item-detail-heading").click(function (e) {
            closeDetail();
          });

          $(".item-detail").fadeIn();
        }

        function closeDetail() {
          if (state.selectedIndex || state.selectedIndex === 0) {
            $(`.${state.selectedIndex}`).removeClass("accent-background");
          }
          $(".item-detail").fadeOut();
        }

        $.ajax({
          method: "GET",
          url: "http://localhost:4000/api/resources",
          dataType: "json",
        }).done(function (res) {
          state = { ...state, data: res.data.rows };
          $.map(res.data.rows, function (data, i) {
            $(".activities").append(`<div class="activities-item ${i}">
                <div class="activities-item-icon">
                  <span>
                    <i class="fa-solid fa-upload"></i>
                  </span>
                </div>
                <div class="activities-item-content">
                  <div class="item-header">
                    <div>
                      <p id="${i}">${data.doc["product-title"]}</p>
                      ${
                        data.doc["product-info"]?.["model-display-tag"]
                          ? `<span>${data.doc["product-info"]?.["model-display-tag"]}</span>`
                          : ""
                      }
                    </div>
                    <span class="filter-icon">
                      <i class="fa-solid fa-filter"></i>
                    </span>
                  </div>
                  <div class="description">
                    <p>${data.doc.type}</p>
                    <p>${getTimeDiff(
                      data.doc["last-modified"].time
                    )}, ${data.doc["last-modified"].by}</p>
                  </div>
                  <div class="post-note">Metadata was updated</div>
                </div>
              </div>`);
          });

          $(".item-header div p").click(function (e) {
            openDetail(Number(e.currentTarget.id));
          });
        });
      });
    </script>
  </body>
</html>
